# 股票池功能实现分析

## 当前系统的限制

通过分析代码，发现当前回测系统只支持单股票回测，主要原因如下：

1. **代码硬编码单股票**：在`run_backtest`函数中，虽然接收了`stockPool`参数，但明确注释了"目前只支持单股票回测，后续可以扩展到股票池"，并硬编码了使用`symbol = 'sz000001'`。

2. **股票池功能未完全实现**：`get_stock_pool`函数只是返回了股票池的基本信息（如id、名称、描述和股票数量），但没有返回实际的成分股列表。

3. **缺少成分股获取API**：整个代码库中没有实现获取股票池成分股的函数或API。

## 如何扩展支持多股票回测

要支持股票池回测，需要进行以下改进：

1. **实现股票池成分股数据存储**：
   - 在数据库中创建表存储股票池与成分股的关系
   - 或者从外部数据源（如Wind、聚宽等）获取实时成分股数据

2. **实现成分股获取函数**：
   ```python
   def get_stock_pool_symbols(stock_pool_id):
       """获取指定股票池的成分股列表"""
       # 根据stock_pool_id从数据库或外部API获取成分股列表
       # 返回成分股代码列表
   ```

3. **修改回测逻辑**：
   - 遍历股票池中的所有股票
   - 对每个股票执行策略计算
   - 实现股票选择和组合优化逻辑

4. **实现组合回测指标计算**：
   - 计算组合收益率、风险等指标
   - 实现资金分配和再平衡逻辑

## 实现建议

1. **短期方案**：
   - 在数据库中创建`stock_pool_component`表，存储股票池与成分股的关系
   - 实现`get_stock_pool_symbols`函数获取成分股列表
   - 修改`run_backtest`函数，支持遍历成分股进行回测

2. **长期方案**：
   - 集成外部数据源，获取实时股票池成分股数据
   - 实现更复杂的股票选择和组合优化算法
   - 支持多策略组合回测

## 结论

当前系统确实只支持单股票回测，股票池功能尚未完全实现。要支持股票池回测，需要进行上述改进。